[gd_resource type="Resource" script_class="StateMachine" load_steps=31 format=3 uid="uid://qjvf06cx05tk"]

[ext_resource type="Script" uid="uid://dj05xcwu35h2s" path="res://addons/imjp94.yafsm/src/states/StateMachine.gd" id="1_g6g7o"]
[ext_resource type="Resource" uid="uid://cfdps1oqufpb6" path="res://GameEndState.tres" id="2_g6g7o"]
[ext_resource type="Script" uid="uid://c32hneu5jvcmt" path="res://addons/imjp94.yafsm/src/states/State.gd" id="2_r12qt"]
[ext_resource type="Script" uid="uid://473tveuavq5t" path="res://addons/imjp94.yafsm/src/transitions/Transition.gd" id="4_u5juq"]
[ext_resource type="Script" uid="uid://41vj1aorhrx8" path="res://addons/imjp94.yafsm/src/conditions/Condition.gd" id="5_82e7v"]

[sub_resource type="GDScript" id="GDScript_g6g7o"]
resource_name = "Game"
script/source = "extends StateInterface

# This code is a stub of the StateInterface.  
# Enter is called once when the state is changed to the current state.  Use to initialize the state

#func enter(parent: Node, from: String) -> void: # Enter State
	#pass

# Exit is called when the state has changed to a different state.  Use it to release resources.
#func exit(parent: Node, to: String) -> void: # Exit of state 
	#pass

# Update is called every frame or manually per StatgeMachinePlayer setting.  Execute state code here.
#func update(parent: Node, delta):
	#pass
"

[sub_resource type="GDScript" id="GDScript_r12qt"]
resource_name = "Entry"
script/source = "extends StateInterface

# This code is a stub of the StateInterface.  
# Enter is called once when the state is changed to the current state.  Use to initialize the state

func enter(parent: Node, from: String) -> void: # Enter State
	var game_scn = parent.game_scn.instantiate()
	game_scn.app_state = parent.app_state
	parent.add_child(game_scn)
	parent.app_state.set_param(\"game_scn\", game_scn)

# Exit is called when the state has changed to a different state.  Use it to release resources.
#func exit(parent: Node, to: String) -> void: # Exit of state 
	#pass

# Update is called every frame or manually per StatgeMachinePlayer setting.  Execute state code here.
#func update(parent: Node, delta):
	#pass
"

[sub_resource type="Resource" id="16"]
script = ExtResource("2_r12qt")
name = "Entry"
state_class = SubResource("GDScript_r12qt")
metadata/graph_offset = Vector2(-93.5, 115.5)

[sub_resource type="GDScript" id="GDScript_xpnr4"]
resource_name = "Exit"
script/source = "extends StateInterface

## Game/Exit

# This code is a stub of the StateInterface.  
# Enter is called once when the state is changed to the current state.  Use to initialize the state

func enter(parent: Node, from: String) -> void: # Enter State
	var game_scn = parent.app_state.get_param(\"game_scn\")
	
	if not (from.ends_with(\"End\")): # Not from Game/End(not finished)
		game_scn.remove_child(game_scn.current_level_instance)
		game_scn.app_state.set_param(\"last_level\", game_scn.current_level_instance)
		game_scn.current_level_instance = null
	if game_scn.game_end_screen_instance:
		game_scn.game_end_screen_instance.queue_free()
 
"

[sub_resource type="Resource" id="17"]
script = ExtResource("2_r12qt")
name = "Exit"
state_class = SubResource("GDScript_xpnr4")
metadata/graph_offset = Vector2(610.5, 104.5)

[sub_resource type="GDScript" id="GDScript_u5juq"]
resource_name = "Load"
script/source = "extends StateInterface

var game_scn: Node

func enter(parent: Node, from: String) -> void: # Enter State
	game_scn = parent.app_state.get_param(\"game_scn\")
	game_scn.load_screen_instance = game_scn.load_sreen_scn.instantiate()
	game_scn.load_screen_instance.set(\"app_state\", parent.app_state)
	game_scn.add_child(game_scn.load_screen_instance)

# Exit is called when the state has changed to a different state.  Use it to release resources.
func exit(parent: Node, to: String) -> void: # Exit of state 
	game_scn.load_screen_instance.queue_free()
	game_scn.load_screen_instance = null
	game_scn.setup_level()
"

[sub_resource type="Resource" id="18"]
script = ExtResource("2_r12qt")
name = "Load"
state_class = SubResource("GDScript_u5juq")
metadata/graph_offset = Vector2(71.5, 115.5)

[sub_resource type="GDScript" id="GDScript_82e7v"]
resource_name = "Pause"
script/source = "extends StateInterface

## Game/Pause

# This code is a stub of the StateInterface.  
# Enter is called once when the state is changed to the current state.  Use to initialize the state

func enter(parent: Node, from: String) -> void: # Enter State
	var game_scn = parent.app_state.get_param(\"game_scn\")
	if not game_scn.pause_menu_instance:
		game_scn.pause_menu_instance = game_scn.pause_menu_scn.instantiate()
		game_scn.pause_menu_instance.set(\"app_state\", parent.app_state)
		if game_scn.current_level_instance is Node2D:
			game_scn.pause_menu_instance.anchor_left = -0.5
			game_scn.pause_menu_instance.anchor_top = -0.5
			game_scn.pause_menu_instance.anchor_right = 0.5
			game_scn.pause_menu_instance.anchor_bottom = 0.5
		else:
			game_scn.pause_menu_instance.set_anchors_preset(Control.PRESET_FULL_RECT)
	game_scn.add_child(game_scn.pause_menu_instance)
	game_scn.get_tree().paused = true

# Exit is called when the state has changed to a different state.  Use it to release resources.
func exit(parent: Node, to: String) -> void: # Exit of state 
	var game_scn = parent.app_state.get_param(\"game_scn\")
	game_scn.remove_child(game_scn.pause_menu_instance) 

"

[sub_resource type="Resource" id="19"]
script = ExtResource("2_r12qt")
name = "Pause"
state_class = SubResource("GDScript_82e7v")
metadata/graph_offset = Vector2(368.5, 324.5)

[sub_resource type="GDScript" id="GDScript_yld54"]
resource_name = "Play"
script/source = "extends StateInterface

## Game/Play

# This code is a stub of the StateInterface.  
# Enter is called once when the state is changed to the current state.  Use to initialize the state

func enter(parent: Node, from: String) -> void: # Enter State
	var game_scn = parent.app_state.get_param(\"game_scn\")
	game_scn.get_tree().paused = false

"

[sub_resource type="Resource" id="20"]
script = ExtResource("2_r12qt")
name = "Play"
state_class = SubResource("GDScript_yld54")
metadata/graph_offset = Vector2(236.5, 115.5)

[sub_resource type="Resource" id="21"]
script = ExtResource("4_u5juq")
from = "End"
to = "Exit"
conditions = {}
priority = 0

[sub_resource type="Resource" id="22"]
script = ExtResource("4_u5juq")
from = "Entry"
to = "Load"
conditions = {}
priority = 0

[sub_resource type="Resource" id="23"]
script = ExtResource("5_82e7v")
name = "load_done"

[sub_resource type="Resource" id="24"]
script = ExtResource("4_u5juq")
from = "Load"
to = "Play"
conditions = {
"load_done": SubResource("23")
}
priority = 0

[sub_resource type="Resource" id="25"]
script = ExtResource("5_82e7v")
name = "quit"

[sub_resource type="Resource" id="26"]
script = ExtResource("4_u5juq")
from = "Pause"
to = "Exit"
conditions = {
"quit": SubResource("25")
}
priority = 0

[sub_resource type="Resource" id="27"]
script = ExtResource("5_82e7v")
name = "continue"

[sub_resource type="Resource" id="28"]
script = ExtResource("4_u5juq")
from = "Pause"
to = "Play"
conditions = {
"continue": SubResource("27")
}
priority = 0

[sub_resource type="Resource" id="29"]
script = ExtResource("5_82e7v")
name = "game_end"

[sub_resource type="Resource" id="30"]
script = ExtResource("4_u5juq")
from = "Play"
to = "End"
conditions = {
"game_end": SubResource("29")
}
priority = 0

[sub_resource type="Resource" id="31"]
script = ExtResource("5_82e7v")
name = "quit"

[sub_resource type="Resource" id="32"]
script = ExtResource("4_u5juq")
from = "Play"
to = "Exit"
conditions = {
"quit": SubResource("31")
}
priority = 0

[sub_resource type="Resource" id="33"]
script = ExtResource("5_82e7v")
name = "pause"

[sub_resource type="Resource" id="34"]
script = ExtResource("4_u5juq")
from = "Play"
to = "Pause"
conditions = {
"pause": SubResource("33")
}
priority = 0

[resource]
script = ExtResource("1_g6g7o")
states = {
"End": ExtResource("2_g6g7o"),
"Entry": SubResource("16"),
"Exit": SubResource("17"),
"Load": SubResource("18"),
"Pause": SubResource("19"),
"Play": SubResource("20")
}
transitions = {
"End": {
"Exit": SubResource("21")
},
"Entry": {
"Load": SubResource("22")
},
"Load": {
"Play": SubResource("24")
},
"Pause": {
"Exit": SubResource("26"),
"Play": SubResource("28")
},
"Play": {
"End": SubResource("30"),
"Exit": SubResource("32"),
"Pause": SubResource("34")
}
}
name = "Game"
state_class = SubResource("GDScript_g6g7o")
metadata/graph_offset = Vector2(899.5, 132.5)
